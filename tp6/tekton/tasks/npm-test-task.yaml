apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: npm-test
  namespace: default
spec:
  description: Exécute les tests npm
  workspaces:
    - name: source
  params:
    - name: node-version
      type: string
      default: "18"
  steps:
    - name: install-dependencies
      image: node:$(params.node-version)-alpine
      workingDir: $(workspaces.source.path)
      script: |
        #!/bin/sh
        set -e
        echo "Installation des dépendances..."
        npm ci

    - name: run-tests
      image: node:$(params.node-version)-alpine
      workingDir: $(workspaces.source.path)
      script: |
        #!/bin/sh
        set -e
        echo "Exécution des tests..."
        npm test

    - name: lint
      image: node:$(params.node-version)-alpine
      workingDir: $(workspaces.source.path)
      script: |
        #!/bin/sh
        set -e
        echo "Linting du code..."
        npm run lint || echo "Pas de lint configuré"
